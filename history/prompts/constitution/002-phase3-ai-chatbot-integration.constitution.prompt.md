---
id: 002
title: Phase 3 AI Chatbot Constitution Integration
stage: constitution
date: 2026-01-20
surface: agent
model: claude-opus-4-5-20251101
feature: phase3-chatbot
branch: 001-fullstack-todo-app
user: saima waheed
command: /sp.constitution
labels: ["ai-chatbot", "mcp", "phase3", "constitution", "openai-agents"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
  - .specify/memory/constitution.md
tests:
  - N/A (constitution update)
---

## Prompt

/sp.constitution

Project: Phase 3 ‚Äì Todo AI Chatbot (Integrated into Phase 2 Todo App)

Core principles:
- Accuracy: AI must perform actions reliably via MCP tools
- Clarity: Chatbot responses must be friendly, clear, and informative
- Reproducibility: All tool calls must be logged in database for stateless recovery
- Security: User authentication enforced; only user-specific data accessible
- Integration: Chatbot seamlessly integrated into Phase 2 frontend

Key standards:
- All tool calls mapped to user messages according to agent behavior specification
- Conversation stored in DB; server remains stateless
- Chat UI integrated as React/Next.js component
- Chat API endpoint secured via JWT
- Use OpenAI Agents SDK + MCP server for task operations
- Database: Neon Serverless PostgreSQL
- ORM: SQLModel
- Backend: FastAPI
- Frontend: Next.js 16+ with ChatKit component
- Authentication: Phase 2 JWT system reused (no Better Auth)
- Folder & file structure automatically generated by Claude

Constraints:
- Stateless backend: no session memory
- MCP tools: add_task, list_tasks, complete_task, delete_task, update_task
- Phase 2 frontend must remain intact; Chatbot integrated as module/component
- Domain allowlist configured for ChatKit frontend
- UX: Floating C

## Response snapshot

Updated constitution from version 1.0.0 to 2.0.0 with the following changes:

**New Core Principles Added:**
- VII. AI Reliability - Ensures chatbot performs task operations reliably via MCP tools with friendly, clear responses
- VIII. Stateless Recovery - Mandates stateless backend with conversation persistence in database

**Technology Constraints Extended:**
- Added AI/Chatbot Stack section specifying OpenAI Agents SDK, MCP protocol, ChatKit UI, and conversation storage

**API Standards Extended:**
- Added Phase 3 Chat API endpoints: POST /api/chat, GET /api/chat/history, DELETE /api/chat/history

**Data Entities Extended:**
- Added Conversation entity (id, user_id, created_at, updated_at)
- Added Message entity (id, conversation_id, role, content, tool_call_id, tool_name, created_at)

**MCP Tool Specifications Added:**
- Defined 5 required MCP tools: add_task, list_tasks, complete_task, delete_task, update_task
- Established Tool Behavior Contract for validation, logging, and error handling
- Specified integration requirements with FastAPI backend

## Outcome

- ‚úÖ Impact: Major constitution update enabling Phase 3 AI chatbot development
- üß™ Tests: N/A (constitution document)
- üìÅ Files: .specify/memory/constitution.md
- üîÅ Next prompts: /sp.specify for Phase 3 chatbot feature spec
- üß† Reflection: Clean extension of existing constitution preserving Phase 1-2 principles while adding AI-specific constraints

## Evaluation notes (flywheel)

- Failure modes observed: None
- Graders run and results (PASS/FAIL): N/A
- Prompt variant (if applicable): Standard constitution update
- Next experiment (smallest change to try): Validate constitution against Phase 3 implementation during /sp.plan
